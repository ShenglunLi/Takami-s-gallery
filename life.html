<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life | TAKAMI's Portfolio</title>
    <!-- 阻擋機器人及Pinterest -->
    <meta name="robots" content="index, follow, noai, max-image-preview:large">
    <meta name="pinterest" content="nopin" description="Sorry, you can't save from this website!" />
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-25..0" />
    <link rel="stylesheet" href="style.css">
    
</head>
<body class="page-life">

    <div class="menu-toggle" id="menuBtn" onclick="toggleMenu()">
        <i class="fa-solid fa-bars menu-icon"></i>
    </div>
    <nav class="full-menu" id="fullMenu">
        <div class="close-menu" onclick="toggleMenu()"><i class="fa-solid fa-xmark"></i></div>
        <a href="index.html">Home</a>
        <a href="new.html">New</a>
        <a href="gallery.html">Gallery</a>
        <a href="life.html">Life</a>
    </nav>

    <header class="page-hero page-hero-large " >
        <div class="page-hero-bg" ></div>
        <div class="hero-content"><h1>Blog</h1><p>生活隨筆</p></div>
    </header>

    <main class="blog-container">
        <div id="blogList">
            </div>
        <div class="pagination" id="pagination">
            </div>
    </main>

    <footer class="footer">
        <p>&copy; 2026 Takami's Gallery. All Rights Reserved.</p>
        <p>本站圖文禁止未經授權之轉載、AI 訓練與商業使用。</p>
        <p>sample@xmail.com</p>
        <ul class="sns-links">
            <li><a href="#" class="sns-btn png-icon" style="--icon: url('img/icon/icon-plurk.png'); --hover: url('img/icon/icon-plurk-hover.png');"></a></li>
            <li><a href="#" class="sns-btn png-icon" style="--icon: url('img/icon/icon-x.png'); --hover: url('img/icon/icon-x-hover.png');"></a></li>
            <li><a href="#" class="sns-btn png-icon" style="--icon: url('img/icon/icon-bluesky.png'); --hover: url('img/icon/icon-bluesky-hover.png');"></a></li>
            <li><a href="#" class="sns-btn png-icon" style="--icon: url('img/icon/icon-pixiv.png'); --hover: url('img/icon/icon-pixiv-hover.png');"></a></li>
        </ul>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

        // Firebase 初始化 (與 gallery 相同)
        const firebaseConfig = {
            apiKey: "AIzaSyDZ9fVnata2mqQb-YPceFKWEdKdQwL6nhA",
            authDomain: "takami-gallery.firebaseapp.com",
            databaseURL: "https://takami-gallery-default-rtdb.firebaseio.com",
            projectId: "takami-gallery",
            storageBucket: "takami-gallery.firebasestorage.app",
            messagingSenderId: "777768543738",
            appId: "1:777768543738:web:f8f0fcf7aa9cdc716f7043"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let allPosts = [];
        let currentPage = 1;
        const postsPerPage = 10;

        async function initBlog() {
            try {
                const response = await fetch('data/content_life.json');
                allPosts = await response.json();
                // 依日期排序 (最新的在前)
                allPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
                renderPage(1);
            } catch (err) {
                console.error("無法載入部落格資料:", err);
            }
        }

        function renderPage(page) {
            const blogList = document.getElementById('blogList');
            const pagination = document.getElementById('pagination');
            blogList.innerHTML = '';

            // --- 調整：處理空內容情況 ---
            if (allPosts.length === 0) {
                blogList.innerHTML = `
                    <div style="text-align: center; padding: 100px 0; color: #888; font-size: 1.2rem;">
                        <p>目前沒有文章 QQ</p>
                    </div>
                `;
                pagination.innerHTML = '';
                return;
            }
            // -------------------------

            currentPage = page;
            const start = (page - 1) * postsPerPage;
            const end = start + postsPerPage;
            const pagedPosts = allPosts.slice(start, end);

            pagedPosts.forEach(post => {
                const card = document.createElement('article');
                card.className = 'blog-card';
                card.onclick = (e) => {
                    // 僅在手機版 (<= 900px) 才切換展開狀態
                    if (window.innerWidth <= 900) {
                        card.classList.toggle('expanded');
                    }
                };

                // 修改渲染卡片的 HTML 結構
                card.innerHTML = `
                    <div class="blog-image">
                        <img src="img/life/${post.img}" alt="Blog Image" loading="lazy">
                    </div>
                    <div class="blog-main">
                        <div class="blog-meta">
                            <span class="date-tag">${post.date}</span>

                        </div>
                        <div class="blog-body">
                            <div class="content-wrapper">
                                <p>${post.content}</p>
                            </div>
                            <button class="more-btn">...more</button>
                        </div>
                    </div>
                `;
                blogList.appendChild(card);
                
                // 串接 Firebase 拍手數據 (僅讀取)
                const clapRef = ref(db, 'claps/' + post.id);
                onValue(clapRef, (snap) => {
                    document.getElementById(`clap-${post.id}`).innerText = snap.val() || 0;
                });
            });

            renderPagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderPagination() {
            const totalPages = Math.ceil(allPosts.length / postsPerPage);
            const container = document.getElementById('pagination');
            container.innerHTML = '';

            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                btn.innerText = i;
                btn.onclick = () => renderPage(i);
                container.appendChild(btn);
            }
        }

        document.addEventListener('DOMContentLoaded', initBlog);
    </script>
    

    <script src="main.js"></script>
</body>
</html>