<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life | TAKAMI's Portfolio</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-25..0" />
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* --- Blog 專屬樣式 --- */
        .blog-container { max-width: 1100px; margin: 0 auto; padding: 40px 20px; min-height: 60vh; }
        
        /* 文章卡片基礎 */
        .blog-card {
            display: flex; gap: 40px; margin-bottom: 80px;
            position: relative;
            align-items: flex-start;
            transition: transform 0.3s ease;
        }
        
        /* 圖片區塊 */
        .blog-image { flex: 0 0 40%; max-width: 450px; }
        .blog-image img { width: 100%; height: auto; border-radius: 4px; display: block; object-fit: cover; }

        /* 文字資訊區塊 */
        .blog-main { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        
        .blog-meta { display: flex;  justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .date-tag { font-size: 0.95rem; color: var(--primary-hover); font-weight: bold; }

        /* --- 電腦版佈局邏輯修正 --- */
        .blog-body { 
            position: relative; 
            width: 100%; 
        }

        .content-wrapper {
            display: block; /* 確保區塊級渲染 */
            column-count: 2;
            column-gap: 30px;
            column-fill: auto;
            height: 16.2em; 
            overflow-y: auto; 
            line-height: 1.8;
            text-align: justify;
            padding-right: 15px; /* 增加空間，讓捲動條有位置顯示 */
            
            /* 針對 Firefox 的極細捲動條設定 */
            scrollbar-width: thin;
            scrollbar-color: var(--icon-muted, #ccc) transparent;
        }

        /* 修正：針對 Webkit (Chrome, Edge, Safari) 的捲動條設定 */
        /* 必須確保選擇器與 HTML 結構完全匹配 */
        .content-wrapper::-webkit-scrollbar {
            width: 4px; /* 極細寬度，太細(如1px)在某些螢幕會完全看不見 */
            display: block;
        }

        .content-wrapper::-webkit-scrollbar-track {
            background: transparent;
        }

        .content-wrapper::-webkit-scrollbar-thumb {
            background-color: var(--primary-color, #ccc);
            border-radius: 10px;
            border: none;
        }

        /* 增加滑動時的反應，方便使用者辨識 */
        .content-wrapper::-webkit-scrollbar-thumb:hover {
            background-color: var(--primary-hover);
        }


        /* 電腦版下隱藏展開元件與遮罩 */
        .more-btn, .fade-overlay { display: none !important; }

        /* --- 手機版 RWD 修正 (900px 以下) --- */
        @media (max-width: 900px) {
            .blog-card { flex-direction: column; gap: 20px; margin-bottom: 40px; cursor: pointer; }
            .blog-image { flex: 0 0 auto; width: 100%; max-width: none; }
            .blog-main { width: 100%; }

            /* 手機版：切換回單欄並限制單行 */
            .content-wrapper {
                column-count: 1;
                height: auto;
                max-height: 1.8em; /* 收合時僅一行 */
                display: -webkit-box;
                -webkit-line-clamp: 1;
                -webkit-box-orient: vertical;
                overflow: hidden;
                padding-right: 0;
                transition: max-height 0.4s ease;
            }

            /* 手機版：重新啟用更多按鈕 (仿社群樣式) */
            .more-btn {
                display: inline-block !important;
                background: none;
                border: none;
                color: var(--icon-hover);
                font-weight: bold;
                font-size: 0.95rem;
                cursor: pointer;
                padding: 0;
                margin-top: 5px;
            }

            /* 手機版：展開狀態 */
            .blog-card.expanded .content-wrapper {
                max-height: none;
                display: block;
                -webkit-line-clamp: unset;
            }
            .blog-card.expanded .more-btn {
                display: none !important;
            }
        }

        /* 拍手樣式 */
        .clap-section { display: flex; align-items: center; gap: 5px; opacity: 0.8; }
        .clap-count { font-size: 0.9rem; color: #888; }
        .material-symbols-outlined { font-size: 20px; }

        /* 分頁樣式 */
        .pagination { display: flex; justify-content: center; gap: 10px; margin-top: 50px; padding-bottom: 50px; }
        .page-btn {
            width: 40px; height: 40px; border: 1px solid var(--primary-color);
            background: transparent; color: var(--primary-color);
            border-radius: 50%; cursor: pointer; transition: 0.3s;
        }
        .page-btn.active, .page-btn:hover { background: var(--primary-color); color: #fff; }
    </style>
</head>
<body>

    <div class="menu-toggle" id="menuBtn" onclick="toggleMenu()">
        <i class="fa-solid fa-bars menu-icon"></i>
    </div>
    <nav class="full-menu" id="fullMenu">
        <div class="close-menu" onclick="toggleMenu()"><i class="fa-solid fa-xmark"></i></div>
        <a href="index.html">Home</a>
        <a href="new.html">New</a>
        <a href="gallery.html">Gallery</a>
        <a href="life.html">Life</a>
    </nav>

    <header class="new-hero" style="height: 30vh;">
        <div class="new-hero-bg" style="background-image: url('img/index/life.jpg');"></div>
        <div class="hero-content"><p>Blog</p><h1>生活隨筆</h1></div>
    </header>

    <main class="blog-container">
        <div id="blogList">
            </div>
        <div class="pagination" id="pagination">
            </div>
    </main>

    <footer class="footer">
        <p>&copy; 2026 Takami's Gallery. All Rights Reserved.</p>
        <p>本站圖文禁止未經授權之轉載、AI 訓練與商業使用。</p>
        <p>sample@xmail.com</p>
        <ul class="sns-links">
            <li><a href="#" class="sns-btn png-icon" style="--icon: url('img/icon/icon-plurk.png'); --hover: url('img/icon/icon-plurk-hover.png');"></a></li>
            <li><a href="#" class="sns-btn png-icon" style="--icon: url('img/icon/icon-x.png'); --hover: url('img/icon/icon-x-hover.png');"></a></li>
            <li><a href="#" class="sns-btn png-icon" style="--icon: url('img/icon/icon-bluesky.png'); --hover: url('img/icon/icon-bluesky-hover.png');"></a></li>
            <li><a href="#" class="sns-btn png-icon" style="--icon: url('img/icon/icon-pixiv.png'); --hover: url('img/icon/icon-pixiv-hover.png');"></a></li>
        </ul>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

        // Firebase 初始化 (與 gallery 相同)
        const firebaseConfig = {
            apiKey: "AIzaSyDZ9fVnata2mqQb-YPceFKWEdKdQwL6nhA",
            authDomain: "takami-gallery.firebaseapp.com",
            databaseURL: "https://takami-gallery-default-rtdb.firebaseio.com",
            projectId: "takami-gallery",
            storageBucket: "takami-gallery.firebasestorage.app",
            messagingSenderId: "777768543738",
            appId: "1:777768543738:web:f8f0fcf7aa9cdc716f7043"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let allPosts = [];
        let currentPage = 1;
        const postsPerPage = 10;

        async function initBlog() {
            try {
                const response = await fetch('data/content_life.json');
                allPosts = await response.json();
                // 依日期排序 (最新的在前)
                allPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
                renderPage(1);
            } catch (err) {
                console.error("無法載入部落格資料:", err);
            }
        }

        function renderPage(page) {
            const blogList = document.getElementById('blogList');
            const pagination = document.getElementById('pagination');
            blogList.innerHTML = '';

            // --- 調整：處理空內容情況 ---
            if (allPosts.length === 0) {
                blogList.innerHTML = `
                    <div style="text-align: center; padding: 100px 0; color: #888; font-size: 1.2rem;">
                        <p>目前沒有文章 QQ</p>
                    </div>
                `;
                pagination.innerHTML = '';
                return;
            }
            // -------------------------

            currentPage = page;
            const start = (page - 1) * postsPerPage;
            const end = start + postsPerPage;
            const pagedPosts = allPosts.slice(start, end);

            pagedPosts.forEach(post => {
                const card = document.createElement('article');
                card.className = 'blog-card';
                card.onclick = (e) => {
                    // 僅在手機版 (<= 900px) 才切換展開狀態
                    if (window.innerWidth <= 900) {
                        card.classList.toggle('expanded');
                    }
                };

                // 修改渲染卡片的 HTML 結構
                card.innerHTML = `
                    <div class="blog-image">
                        <img src="img/life/${post.img}" alt="Blog Image" loading="lazy">
                    </div>
                    <div class="blog-main">
                        <div class="blog-meta">
                            <span class="date-tag">${post.date}</span>
                            <div class="clap-section">
                                <span class="material-symbols-outlined">favorite</span>
                                <span class="clap-count" id="clap-${post.id}">-</span>
                            </div>
                        </div>
                        <div class="blog-body">
                            <div class="content-wrapper">
                                ${post.content}
                            </div>
                            <button class="more-btn">...more</button>
                        </div>
                    </div>
                `;
                blogList.appendChild(card);
                
                // 串接 Firebase 拍手數據 (僅讀取)
                const clapRef = ref(db, 'claps/' + post.id);
                onValue(clapRef, (snap) => {
                    document.getElementById(`clap-${post.id}`).innerText = snap.val() || 0;
                });
            });

            renderPagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderPagination() {
            const totalPages = Math.ceil(allPosts.length / postsPerPage);
            const container = document.getElementById('pagination');
            container.innerHTML = '';

            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                btn.innerText = i;
                btn.onclick = () => renderPage(i);
                container.appendChild(btn);
            }
        }

        window.toggleMenu = function() {
            const menu = document.getElementById('fullMenu');
            const btn = document.getElementById('menuBtn');
            const isActive = menu.classList.toggle('active');
            isActive ? btn.classList.add('hidden') : btn.classList.remove('hidden');
        };

        document.addEventListener('DOMContentLoaded', initBlog);
    </script>


    <script>
        // 1. 變數宣告
        const menuBtn = document.getElementById('menuBtn');
        const fullMenu = document.getElementById('fullMenu');
        let lastScrollY = window.scrollY;

        // 2. 定義切換函式
        window.toggleMenu = function() { // 使用 window 確保 HTML onclick 能讀取到
            if (!fullMenu || !menuBtn) return;

            const isActive = fullMenu.classList.toggle('active');
            
            if (isActive) {
                menuBtn.classList.add('hidden');
                // 防止開啟選單時底層頁面捲動 (手機端優化)
                document.body.style.overflow = 'hidden';
            } else {
                menuBtn.classList.remove('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        // 3. 核心捲動偵測邏輯
        window.addEventListener('scroll', () => {
            if (fullMenu.classList.contains('active')) return;

            const currentScrollY = window.scrollY;
            const delta = currentScrollY - lastScrollY;

            // 向下捲動超過 50px 隱藏，向上捲動則顯示
            if (delta > 0 && currentScrollY > 50) {
                menuBtn.classList.add('hidden');
            } else if (delta < 0) {
                menuBtn.classList.remove('hidden');
            }

            lastScrollY = currentScrollY;
        }, { passive: true });
    </script>
</body>
</html>